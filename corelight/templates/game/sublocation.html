{% extends 'base.html' %}
{% block title %}{{ sublocation.name }}{% endblock %}

{% block content %}
  <div class="container mt-4 card shadow-sm">
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ -->
    <div class="text-center mb-4">
      <h1 class="mb-2" style="font-family: 'MedievalSharp', cursive; font-size: 1.4rem; color: #3e3a30;">
        {{ sublocation }}
      </h1>
      <p class="text-muted" style="font-size: 0.9rem;">
        –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞: {{ global_location.name }}
      </p>
    </div>

    <!-- –ë–ª–æ–∫ –æ—Ç–¥—ã—Ö–∞) -->
    {% if current_user_data.on_cooldown %}
    <div class="alert alert-warning text-center mb-4" style="font-family: 'MedievalSharp', cursive; font-size: 0.7rem; color: #8B5E3C;">
        –í—ã —Å–ª–∏—à–∫–æ–º —É—Å—Ç–∞–ª–∏ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–µ–¥–∏–Ω–∫–∞. –û—Ç–¥—ã—Ö–∞–π—Ç–µ –µ—â—ë 
        <strong id="cooldown-timer">{{ current_user_data.cooldown }}</strong> 
        —Å–µ–∫—É–Ω–¥(—ã).
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –æ—Ç Django (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        let secondsLeft = {{ current_user_data.cooldown }};
        const timerElement = document.getElementById('cooldown-timer');

        function countdown() {
        if (secondsLeft <= 0) {
            // –í—Ä–µ–º—è –≤—ã—à–ª–æ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ª–æ–∫–∞—Ü–∏—é
            window.location.href = "{% url 'game:sublocation' current_user_data.current_global_location.slug current_user_data.current_sublocation.slug %}";
            return;
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        timerElement.textContent = secondsLeft;
        secondsLeft -= 1;

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ç–∏–∫ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        setTimeout(countdown, 1000);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
        countdown();
    </script>


    {% endif %}


    <!-- –ë–ª–æ–∫: –ú–æ–Ω—Å—Ç—Ä—ã -->
    <div class="card shadow-sm mb-4">
    <div class="card-header bg-white py-2" style="font-family: 'MedievalSharp', cursive; font-size: 1.1rem; color: #5a5448; text-align: center;">
        ‚öî –¶–µ–ª–∏ –¥–ª—è –æ—Ö–æ—Ç—ã
    </div>
        <div class="card-body p-3">
            <!-- –°–µ—Ç–∫–∞ 2x2 -->
            <div class="row g-3 justify-content-center">
            {% for monster in monsters %}
                <div class="col-6 d-flex">
                <div class="card h-100 w-100 shadow-sm" style="border-radius: 6px; border: 2px solid #b8860b;">
                    <div class="card-body d-flex flex-column p-2">
                    <!-- –ò–º—è –º–æ–Ω—Å—Ç—Ä–∞ -->
                    <h6 class="card-title text-center mb-2" style="font-family: 'MedievalSharp', cursive; font-size: 0.95rem; color: #3e3a30;">
                        {{ monster }}
                    </h6>

                    <!-- –ê–≤–∞—Ç–∞—Ä –º–æ–Ω—Å—Ç—Ä–∞ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π, 3:4) -->
                    <div class="d-flex justify-content-center mb-2">
                        <div class="d-flex justify-content-center mb-2" style="border: 1px solid #b8860b;">
                            {% if monster.avatar %}
                                <img src="{{ monster.avatar.url }}" 
                                    alt="{{ monster.name }}" 
                                    style="width: 60px; height: 80px; object-fit: cover; object-position: top; border-radius: 4px; border: 1px solid #d5d0c2;">
                            {% else %}
                                <div style="width: 60px; height: 80px; background-color: #f0eae2; border: 1px solid #d5d0c2; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #8a8375;">
                                ?
                                </div>
                            {% endif %}
                        </div>
                    </div>

                        <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–ø–∞—Å—Ç—å" -->
                        <div class="d-flex justify-content-center mt-2">
                            {% if not current_user_data.on_cooldown %}
                                <a href="{% url 'game:attack_monster' current_user_data.current_global_location.slug current_user_data.current_sublocation.slug monster.slug %}" class="btn btn-primary">
                                    –ê—Ç–∞–∫–æ–≤–∞—Ç—å
                                </a>
                            {% else %}
                                <a href="{% url 'game:attack_monster' current_user_data.current_global_location.slug current_user_data.current_sublocation.slug monster.slug %}" class="btn btn-primary-disabled">
                                –ê—Ç–∞–∫–æ–≤–∞—Ç—å
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                </div>
            {% endfor %}
            </div>
        </div>
    </div>

    <!-- –î–≤–∞ –±–ª–æ–∫–∞ –≤ —Ä—è–¥: –î–æ–±—ã—á–∞ –∏ –°–±–æ—Ä -->
    <div class="row g-4 mb-2">
      <!-- –î–æ–±—ã—á–∞ –º–∏–Ω–µ—Ä–∞–ª–æ–≤ -->
      <div class="col-md-6 card shadow-sm">
          <div class="card-header bg-white py-2" style="font-family: 'MedievalSharp', cursive; font-size: 1.05rem; color: #5a5448; text-align: center;">
            ‚õèÔ∏è –î–æ–±—ã—á–∞ –º–∏–Ω–µ—Ä–∞–ª–æ–≤
          </div>
          <div class="card-body p-3">
            <!-- –°—é–¥–∞ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –¥–æ–±—ã—á–µ -->
            <div id="mining-content">
              <!-- –ü—É—Å—Ç–æ -->
            </div>
          </div>
      </div>

      <!-- –°–±–æ—Ä —Ç—Ä–∞–≤ -->
      <div class="col-md-6 card shadow-sm">
          <div class="card-header bg-white py-2" style="font-family: 'MedievalSharp', cursive; font-size: 1.05rem; color: #5a5448; text-align: center;">
            üåø –°–±–æ—Ä —Ç—Ä–∞–≤
          </div>
          <div class="card-body p-3">
            <!-- –°—é–¥–∞ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ —Å–±–æ—Ä—É -->
            <div id="herbalism-content">
              <!-- –ü—É—Å—Ç–æ -->
            </div>
          </div>
      </div>
    </div>

  </div>
{% endblock %}

